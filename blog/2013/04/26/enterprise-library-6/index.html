<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Enterprise Library 6</title>
    <meta name="author" content="Vu Hai Do" />    
    <link rel="stylesheet" type="text/css" href="/stylesheets/screen.css">   
    <link href="http://feeds.feedburner.com/github/dohaivu" rel="alternate" title="RSS" type="application/rss+xml" />
  </head>

  <body>
    <div id="header" class="section">
      <div class="wrapper">
        <strong id="blog-title">
          <a href="/" rel="home">A Passion Developer</a>
        </strong>
        <p id="blog-description"></p>
        <div id="navigation">
          <ul class="nav clearfix">
            <li class="first-child"><a href="/blog.html">Blog</a></li>            
            <li><a href="/about.html">About</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div id="main" class="section">
	<div class="wrapper">
        <div id="content-post">
		<div class="full">
		  <h1 class="entry-title">
			<a href="/blog/2013/04/26/enterprise-library-6/" title="Enterprise Library 6" rel="bookmark">Enterprise Library 6</a>
		  </h1>
		  <div class="entry-content">
			<p>I&#39;m very excited that <a href="http://blogs.msdn.com/b/agile/archive/2013/04/25/just-released-microsoft-enterprise-library-6.aspx">Enterprise Library 6 has released</a>. I have used this library for a long time. It&#39;s very useful and powerful, it saves me a lot of time.</p>

<p>I will explore what changes in this release</p>

<p>Links:
- <a href="http://msdn.microsoft.com/en-US/library/dn169621.aspx">MSDN Enterprise Library 6</a>
- <a href="http://entlib.codeplex.com/wikipage?title=EntLib6&amp;referringTitle=Home">Enterprise Library 6 Project Home</a></p>

<p><strong>What is Enterprise Library?</strong></p>

<p>Enterprise Library is a collection of application blocks, each aimed at managing specific crosscutting concerns. Crosscutting concerns are task thats you implement in various places in your application. The risk of that is your team will implement differently in your application. Enterprise Library application block make it easy to manage by providing generic and configurable functionality that you can customize and manage.</p>

<p>Enterprise Library 6 contains the following application blocks:
- Data Access
- Exception Handling
- Logging
- Policy Injection
- Semantic Logging
- Transient Fault Handling
- Unity
- Validation</p>

<p>I will develop a Web app to explore how it work</p>

<h2 id="toc_0">Install Enterprise Library 6</h2>

<ul>
<li>Reference assemblies to your project if you <a href="http://www.microsoft.com/en-us/download/details.aspx?id=38789">downloaded</a> and installed it manually .</li>
<li>Use NuGet package manager</li>
</ul>

<h2 id="toc_1">Data Access Application Block</h2>

<p>The Data Access Application Block provide two key advantages: 
- abstracts the actual database, so you can switch from one database to another
- easy to write the most commonly used tasks.</p>

<h3 id="toc_2">Configuring the Block and add assemblies</h3>

<p>We can configure the default database in web.config. <a href="http://www.microsoft.com/en-us/download/details.aspx?id=38789">Enterprise Library configuration tool</a> provide us a GUI interface for easier to config</p>
<div class="highlight"><pre><code class="xml language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
<span class="nt">&lt;configSections&gt;</span>
  <span class="nt">&lt;section</span> <span class="na">name=</span><span class="s">&quot;dataConfiguration&quot;</span> <span class="na">type=</span><span class="s">&quot;Microsoft.Practices.EnterpriseLibrary.Data.Configuration.DatabaseSettings, Microsoft.Practices.EnterpriseLibrary.Data&quot;</span> <span class="na">requirePermission=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/configSections&gt;</span>
<span class="nt">&lt;dataConfiguration</span> <span class="na">defaultDatabase=</span><span class="s">&quot;BookDatabase&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;connectionStrings&gt;</span>
  <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;BookDatabase&quot;</span> <span class="na">connectionString=</span><span class="s">&quot;Server=SqlServer;Database=Book;User Id=sa;Password=Password@123;Connection Timeout=30;&quot;</span> <span class="na">providerName=</span><span class="s">&quot;System.Data.SqlClient&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/connectionStrings&gt;</span>
...
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>
<h3 id="toc_3">Create database instances</h3>
<div class="highlight"><pre><code class="csharp language-csharp" data-lang="csharp"><span class="c1">//load config from web.config</span>
<span class="n">DatabaseProviderFactory</span> <span class="n">dbFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DatabaseProviderFactory</span><span class="p">();</span>
<span class="c1">//create database use default config</span>
<span class="n">SqlDatabase</span> <span class="n">db</span> <span class="p">=</span> <span class="n">dbFactory</span><span class="p">.</span><span class="n">CreateDefault</span><span class="p">()</span> <span class="k">as</span> <span class="n">SqlDatabase</span><span class="p">;</span>            
</code></pre></div>
<h3 id="toc_4">Manage connections</h3>

<p>ADO.NET often holds a pool of connections. ADO.NET automatically retrieves connections from the pool when possible, otherwise it will create a new connection. It also decide when and whether to close the underlying connections and dispose it.</p>

<p>The Data Access Block helps you manage your database connection automatically.</p>

<p><strong>ExecuteDataSet</strong> method will open and close connection automatically. In contrast, <strong>ExecuteReader</strong> open connection, but do not close it automatically. You can change <strong>CommandBahavior</strong> property by setting it to <strong>CloseConnection</strong>, so that it will close database connection automatically when you dispose the reader.</p>

<h4 id="toc_5">Transactions</h4>

<p><strong>Connection based transaction</strong></p>
<div class="highlight"><pre><code class="csharp language-csharp" data-lang="csharp"><span class="k">using</span> <span class="p">(</span><span class="n">DbConnection</span> <span class="n">conn</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">CreateConnection</span><span class="p">())</span>
<span class="p">{</span>
  <span class="n">conn</span><span class="p">.</span><span class="n">Open</span><span class="p">();</span>
  <span class="n">DbTransaction</span> <span class="n">trans</span> <span class="p">=</span> <span class="n">conn</span><span class="p">.</span><span class="n">BeginTransaction</span><span class="p">();</span>
  <span class="k">try</span>
  <span class="p">{</span>
    <span class="c1">// execute commands, passing in the current transaction to each one</span>
    <span class="n">db</span><span class="p">.</span><span class="n">ExecuteNonQuery</span><span class="p">(</span><span class="n">cmdA</span><span class="p">,</span> <span class="n">trans</span><span class="p">);</span>
    <span class="n">db</span><span class="p">.</span><span class="n">ExecuteNonQuery</span><span class="p">(</span><span class="n">cmdB</span><span class="p">,</span> <span class="n">trans</span><span class="p">);</span>
    <span class="n">trans</span><span class="p">.</span><span class="n">Commit</span><span class="p">();</span> <span class="c1">// commit the transaction</span>
  <span class="p">}</span>
  <span class="k">catch</span>
  <span class="p">{</span>
    <span class="n">trans</span><span class="p">.</span><span class="n">Rollback</span><span class="p">();</span> <span class="c1">// rollback the transaction</span>
  <span class="p">}</span>
<span class="p">}</span> 
</code></pre></div>
<p><strong>Distributed Transaction</strong>: access different database as part of the same transaction. Data Access will automatically detect if commands are executed within the scope of a transaction</p>
<div class="highlight"><pre><code class="csharp language-csharp" data-lang="csharp"><span class="k">using</span> <span class="p">(</span><span class="n">TransactionScope</span> <span class="n">scope</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TransactionScope</span><span class="p">(</span><span class="n">TransactionScopeOption</span><span class="p">.</span><span class="n">RequiresNew</span><span class="p">))</span>
<span class="p">{</span>
  <span class="c1">// perform data access here</span>
<span class="p">}</span> 
</code></pre></div>
			<div class="clear"></div>
		  </div>
		  <p class="alt-font tight">
			Posted in&nbsp;
			
			<a href="/categories/library" title="library" rel="category tag">library</a>
			
			&nbsp;&nbsp;&nbsp;
			Tags &nbsp;
			
				<a href="/tags/entlib/">entlib</a> &nbsp;
			
				<a href="/tags/logging/">logging</a> &nbsp;
			
				<a href="/tags/unity/">unity</a> &nbsp;
			
		  </p>
			
		  <p class="by-line">
			<span class="date full-date">
			  <abbr class="published" title="2013-04-26 00:00:00 +0700">26 Apr 2013</abbr>
			</span>
		  </p>
		  <div class="clear"></div>
		</div>
		</div>
		</div>
	</div>
</body>
</html>